function editTruck(e){const t=new URLSearchParams(window.location.search),a=t.get("saleId");JSON.parse(localStorage.getItem("sales"));window.location.href=`adicionar-caminhao.html?saleId=${a}&truckId=${e}`}document.addEventListener("DOMContentLoaded",function(){const e=new URLSearchParams(window.location.search),t=e.get("saleId"),a=e.get("truckId"),n=JSON.parse(localStorage.getItem("sales"))||[],s=document.getElementById("salesContainer"),r=document.getElementById("saveSaleButton"),o=document.getElementById("saleSummary"),c=document.getElementById("addTruckButton"),i=document.getElementById("saveTruckButton"),l=document.getElementById("trucksList"),d=(e,t="number")=>{switch(e&&!isNaN(e)||(e=0),t){case"currency":return e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});case"arrobas":case"weight":return e.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2});default:return e.toLocaleString("pt-BR")}},m=()=>{s.innerHTML="",0===n.length?s.innerHTML='<li class="list-group-item">Nenhuma venda encontrada</li>':n.forEach((e,t)=>{const a=document.createElement("li");a.classList.add("list-group-item"),a.innerHTML=`\n                    <div class="card mb-3">\n                        <div class="card-body">\n                            <div>\n                                <h5 class="card-title">${e.name}</h5>\n                                <p class="card-text text-muted">${e.date}</p>\n                                <a href="resumo-da-venda.html?saleId=${t}" class="btn btn-primary mt-2">Ver Resumo</a>\n                            </div>\n                            <div class="icon-delete-container">\n                                <i class="fas fa-trash-alt text-danger icon-delete" style="cursor: pointer;" onclick="deleteSale(${t})"></i>\n                            </div>\n                        </div>\n                    </div>\n                `,s.appendChild(a)})};if(window.deleteSale=(e=>{const t=confirm("Tem certeza que deseja excluir esta venda?");t&&(n.splice(e,1),localStorage.setItem("sales",JSON.stringify(n)),m())}),s&&m(),r&&r.addEventListener("click",function(){const e=document.getElementById("saleName");let t=e.value.trim();const a=new Date,s=String(a.getDate()).padStart(2,"0"),r=["JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"],o=r[a.getMonth()],c=a.getFullYear(),i=`${s}-${o}-${c}`,l=a.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"});t=t?`${t.toUpperCase()} ${i}`:`VENDA GADO ${i}, ${l}`;const d={name:t,date:i,trucks:[]};n.push(d),localStorage.setItem("sales",JSON.stringify(n)),window.location.href="pesagem-gado.html"}),o&&t&&n[t]){const e=n[t];let a=0,s=0,r=0;e.trucks&&e.trucks.length>0&&e.trucks.forEach((e,t)=>{a+=e.cattleWeight||0,s+=e.totalArrobas||0,r+=e.totalValue||0;const n=document.createElement("div");n.classList.add("card","mb-3"),n.innerHTML=`\n                    <div class="card-body">\n                        <h5 class="card-title">Caminhão: <span class="truck-name">${e.plate}</span></h5>\n                        <p class="card-text">\n                            TARA: ${d(e.taraWeight,"weight")} kg<br>\n                            Peso Bruto: ${d(e.grossWeight,"weight")} kg<br>\n                            Peso Gado: ${d(e.cattleWeight,"weight")} kg<br>\n                            Total Arrobas: ${d(e.totalArrobas,"arrobas")}<br>\n                            Valor Total: ${d(e.totalValue,"currency")}\n                        </p>\n                        <button class="btn btn-warning" onclick="editTruck(${t})">Editar</button>\n                    </div>\n                `,l.appendChild(n)});const i=.015*r,m=r-i;o.innerHTML=`\n            <p id="saleName">${e.name}</p>\n            <div class="summary-item">\n                <span>Total de Peso (kg):</span> ${d(a,"weight")}\n            </div>\n            <div class="summary-item arrobas-to-valor">\n                <span>Total de Arrobas:</span> ${d(s,"arrobas")}\n            </div>\n            <div class="summary-item">\n                <span id="valorBruto">Valor Bruto:</span> ${d(r,"currency")}\n            </div>\n            <div class="summary-item">\n                <span>Desconto FUNRURAL (1,5%):</span> ${d(i,"currency")}\n            </div>\n            <div class="summary-item" id="valorLiquido">\n                <span>Valor Líquido:</span> ${d(m,"currency")}\n            </div>\n        `,c&&(c.href=`adicionar-caminhao.html?saleId=${t}`)}if(i&&t&&n[t]){if(a&&n[t].trucks[a]){const e=n[t].trucks[a];document.getElementById("truckPlate").value=e.plate,document.getElementById("taraWeight").value=e.taraWeight,document.getElementById("grossWeight").value=e.grossWeight,document.getElementById("headsCount").value=e.headsCount}i.addEventListener("click",function(){const e=document.getElementById("truckPlate").value.trim(),s=parseFloat(document.getElementById("taraWeight").value),r=parseFloat(document.getElementById("grossWeight").value),o=parseInt(document.getElementById("headsCount").value);if(!e||isNaN(s)||isNaN(r)||isNaN(o))alert("Por favor, preencha todos os campos corretamente.");else{const c=r-s,i=c/o,l=.53*i/15,d=o*l,m=330*d,u={plate:e,taraWeight:s,grossWeight:r,cattleWeight:c,headsCount:o,totalArrobas:d,totalValue:m};a&&n[t].trucks[a]?n[t].trucks[a]=u:n[t].trucks.push(u),localStorage.setItem("sales",JSON.stringify(n)),window.location.href=`resumo-da-venda.html?saleId=${t}`}})}});const convertDate=e=>{const[t,a,n]=e.split("-"),s={JAN:"01",FEV:"02",MAR:"03",ABR:"04",MAI:"05",JUN:"06",JUL:"07",AGO:"08",SET:"09",OUT:"10",NOV:"11",DEZ:"12"},r=s[a.toUpperCase()];return`${n}-${r}-${t}`};document.addEventListener("DOMContentLoaded",function(){const e=JSON.parse(localStorage.getItem("sales"))||[];let t=!0;const a=document.getElementById("salesContainer"),n=document.getElementById("searchInput"),s=document.getElementById("sortByDateBtn"),r=e=>{a.innerHTML="",0===e.length?a.innerHTML='<li class="list-group-item">Nenhuma venda encontrada</li>':e.forEach((e,t)=>{const n=document.createElement("li");n.classList.add("list-group-item"),n.innerHTML=`\n                <div class="card mb-3">\n                    <div class="card-body d-flex justify-content-between align-items-center">\n                        <div>\n                            <h5 class="card-title">${e.name}</h5>\n                            <p class="card-text text-muted">${e.date}</p>\n                        </div>\n                        <div class="actions d-flex align-items-center">\n                            <a href="resumo-da-venda.html?saleId=${t}" class="btn btn-primary">Ver Resumo</a>\n                            <i class="fas fa-trash-alt text-danger icon-delete" style="cursor: pointer;" onclick="deleteSale(${t})"></i>\n                        </div>\n                    </div>\n                </div>\n            `,a.appendChild(n)})};window.deleteSale=(t=>{const a=confirm("Tem certeza que deseja excluir esta venda?");a&&(e.splice(t,1),localStorage.setItem("sales",JSON.stringify(e)),r(e))}),n.addEventListener("input",function(){const t=n.value.toLowerCase(),a=e.filter(e=>e.name.toLowerCase().includes(t));r(a)}),s.addEventListener("click",function(){e.sort((e,a)=>{const n=new Date(convertDate(e.date)),s=new Date(convertDate(a.date));return t?n-s:s-n}),t=!t,r(e)}),r(e)});