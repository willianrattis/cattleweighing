document.addEventListener("DOMContentLoaded",function(){const e=new URLSearchParams(window.location.search),t=e.get("saleId"),a=e.get("truckId"),l=JSON.parse(localStorage.getItem("sales"))||[],n=document.getElementById("truckPlate"),r=document.getElementById("taraWeight"),o=document.getElementById("grossWeight"),s=document.getElementById("headsCount"),u=document.getElementById("arrobaValue"),c=document.getElementById("calculateButton"),d=document.getElementById("results"),i=e=>new Intl.NumberFormat("pt-BR").format(Math.floor(e)),g=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),m=e=>parseFloat(e.replace(/\./g,"").replace(",",".")),h=e=>parseFloat(e.replace(/[^\d,-]/g,"").replace(",","."));if(a&&l[t].trucks[a]){const e=l[t].trucks[a];n.value=e.plate,r.value=i(e.taraWeight),o.value=i(e.grossWeight),s.value=e.headsCount||0,u.value=g(e.arrobaValue||0)}r.addEventListener("input",function(e){let t=m(e.target.value);isNaN(t)||(r.value=i(t))}),o.addEventListener("input",function(e){let t=m(e.target.value);isNaN(t)||(o.value=i(t))}),u.addEventListener("input",function(e){let t=u.value.replace(/\D/g,"");t.length>0&&(u.value=g(parseFloat(t/100)))}),c.addEventListener("click",function(){const e=n.value.trim(),c=m(r.value),g=m(o.value),v=parseInt(s.value)||0,p=h(u.value)||0;if(e&&!isNaN(c)){const n=g-c,r=v>0?n/v:0,o=.53*r/15,s=v*o,u=s*p;if(document.getElementById("cattleWeight").innerText=i(n),document.getElementById("averageWeight").innerText=r.toFixed(2),document.getElementById("averageArrobas").innerText=o.toFixed(2),document.getElementById("totalArrobas").innerText=s.toFixed(2),d.style.display="block",a&&l[t].trucks[a])l[t].trucks[a]={plate:e,taraWeight:c,grossWeight:g,cattleWeight:n,headsCount:v,totalArrobas:s,totalValue:u,arrobaValue:p};else{const a={plate:e,taraWeight:c,grossWeight:g,cattleWeight:n,headsCount:v,totalArrobas:s,totalValue:u,arrobaValue:p};l[t].trucks.push(a)}localStorage.setItem("sales",JSON.stringify(l)),window.location.href=`resumo-da-venda.html?saleId=${t}`}else alert("Por favor, preencha os campos obrigat√≥rios.")});const v=document.getElementById("backToSummary");v&&t&&v.setAttribute("href",`resumo-da-venda.html?saleId=${t}`)});